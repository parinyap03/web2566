<!DOCTYPE html>
<html lang="en">

<head>
    <title>Work6</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.10/dist/vuetify.min.js"></script>

</head>

<body>
    <div id="app">
        <v-app>
            <v-container>
                <v-card>
                    <v-card-title class="bg-blue-grey">{{title}}</v-card-title>
                    <v-card-text class="pa-6">
                        <pre>{{students}}</pre>
                    </v-card-text>

                    <v-card-actions>
                        <v-btn @click="readData()">Read Data (get)</v-btn>
                        <v-btn @click="autoRead()">Auto Read (onSnapshot)</v-btn>
                    </v-card-actions>
                </v-card>
                <div class="pa-6 text-center">{{footer}}</div>
            </v-container>
        </v-app>
    </div>



    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBCjr9aEykkRcxK6J7JwbVzry6XGLqQkp0",
            authDomain: "web2566-f21d6.firebaseapp.com",
            projectId: "web2566-f21d6",
            storageBucket: "web2566-f21d6.appspot.com",
            messagingSenderId: "258091733417",
            appId: "1:258091733417:web:ed3bf2fedce451b93a34b8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const vuetify = Vuetify.createVuetify();
        const app = Vue.createApp({
            data() {
                return {
                    title: "Work 6:  เรียกใช้ฐานข้อมูล Firebase ด้วย VueJS",
                    footer: "ระบุ รหัส ชื่อ-สกุล สาขา",
                    students: [],
                };

            },
        })
        methods: {
            readData() {
                db.collection("students")
                    .get()
                    .then((querySnapshot) => {
                        var stdlist = [];
                        querySnapshot.forEach((doc) => {
                            stdlist.push({ id: doc.id, ...doc.data() });
                        });
                        this.students = stdlist;
                    });
            },
            autoRead() {
                db.collection("students").onSnapshot((querySnapshot) => {
                    var stdlist = [];
                    querySnapshot.forEach((doc) => {
                        stdlist.push({ id: doc.id, ...doc.data() });
                    });
                    this.students = stdlist;
                });
            },
        },

        app.use(vuetify).mount("#app");
    </script>
</body>

</html>